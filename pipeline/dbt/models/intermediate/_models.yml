version: 2

models:
  - name: int__services
  - name: int__structures
  - name: int__plausible_personal_emails
  - name: int__deprecated_sirets
  - name: int__enhanced_structures

  - name: int__validated_structures
    columns:
      - name: _di_surrogate_id
        tests:
          - not_null
          - unique
      - name: source
        tests:
          - not_null
      - name: id
        tests:
          - not_null
      - name: nom
        tests:
          - not_null
      - name: commune
        tests:
          - not_null
      - name: adresse
        tests:
          - not_null
      - name: date_maj
        tests:
          - not_null

  - name: int__validated_services
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - source
            - id
    columns:
      - name: _di_structure_surrogate_id
        tests:
          - relationships:
              to: ref('int__validated_structures')
              field: _di_surrogate_id
      - name: _di_surrogate_id
        tests:
          - not_null
          - unique
      - name: source
        tests:
          - not_null
      - name: structure_id
        tests:
          - not_null
      - name: id
        tests:
          - not_null
      - name: nom
        tests:
          - not_null

  - name: int__structure_validation_errors
    description: List validation errors of mapped structure entries
    columns:
      - name: _di_surrogate_id
      - name: _di_source_id
      - name: id
      - name: field
      - name: value
      - name: type

  - name: int__service_validation_errors
    description: List validation errors of mapped service entries
    columns:
      - name: _di_structure_surrogate_id
      - name: _di_surrogate_id
      - name: _di_source_id
      - name: id
      - name: field
      - name: value
      - name: type