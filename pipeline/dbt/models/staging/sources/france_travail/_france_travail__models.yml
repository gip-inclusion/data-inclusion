version: 2

models:
  - name: stg_france_travail__agences
    columns:
      - name: code
        data_tests:
          - unique
          - not_null
          - dbt_utils.not_empty_string
      - name: dispositif_adeda
        data_tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: adresse_principale__gps_lat
        data_tests:
          - not_null
      - name: adresse_principale__gps_lon
        data_tests:
          - not_null
      - name: adresse_principale__ligne_4
        data_tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: adresse_principale__ligne_3
        data_tests:
          - dbt_utils.at_least_one
          - dbt_utils.not_empty_string
      - name: adresse_principale__commune_implantation
        data_tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: adresse_principale__bureau_distributeur
        data_tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: contact__email
        data_tests:
          - not_null:
              config:
                error_if: ">100"
          - dbt_utils.not_empty_string
      - name: contact__telephone_public
        data_tests:
          - not_null:
              config:
                error_if: ">100"
          - dbt_utils.not_empty_string
      - name: horaires
        data_tests:
          - not_null
      - name: libelle_etendu
        data_tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: siret
        data_tests:
          - not_null:
              config:
                error_if: ">100"
          - dbt_utils.not_empty_string
      - name: type
        data_tests:
          - not_null
          - dbt_utils.not_empty_string

  - name: stg_france_travail__services
    columns:
      - name: id
        data_tests:
          - unique
          - not_null
          - dbt_utils.not_empty_string
          - dbt_utils.not_constant
      - name: date_maj
        data_tests:
          - not_null
      - name: nom
        data_tests:
          - not_null
          - dbt_utils.not_empty_string
          - dbt_utils.not_constant
      - name: description
        data_tests:
          - not_null
          - dbt_utils.not_empty_string
          - dbt_utils.not_constant
      - name: lien_source
        data_tests:
          - dbt_utils.not_empty_string
      - name: type
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('types_de_services_v1')
                field: value
      - name: frais_precisions
        data_tests:
          - dbt_utils.not_empty_string
      - name: publics_precisions
        data_tests:
          - dbt_utils.not_empty_string
      - name: conditions_acces
        data_tests:
          - dbt_utils.not_empty_string
      - name: telephone
        data_tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: courriel
        data_tests:
          - dbt_utils.not_empty_string
      - name: contact_nom_prenom
        data_tests:
          - dbt_utils.not_empty_string
      - name: lien_mobilisation
        data_tests:
          - dbt_utils.not_null_proportion:
              arguments:
                at_least: 0.5
          - dbt_utils.not_empty_string
      - name: mobilisation_precisions
        data_tests:
          - dbt_utils.not_empty_string
      - name: zone_eligibilite
      - name: volume_horaire_hebdomadaire
      - name: nombre_semaines
      - name: horaires_accueil

  - name: stg_france_travail__services__frais
    columns:
      - name: service_id
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_france_travail__services')
                field: id
      - name: value
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('frais_v1')
                field: value

  - name: stg_france_travail__services__modes_accueil
    columns:
      - name: service_id
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_france_travail__services')
                field: id
      - name: value
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('modes_accueil_v1')
                field: value

  - name: stg_france_travail__services__modes_mobilisation
    columns:
      - name: service_id
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_france_travail__services')
                field: id
      - name: value
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('modes_mobilisation_v1')
                field: value

  - name: stg_france_travail__services__mobilisable_par
    columns:
      - name: service_id
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_france_travail__services')
                field: id
      - name: value
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('personne_mobilisatrice_v1')
                field: value

  - name: stg_france_travail__services__publics
    columns:
      - name: service_id
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_france_travail__services')
                field: id
      - name: value
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('publics_v1')
                field: value

  - name: stg_france_travail__services__thematiques
    columns:
      - name: service_id
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_france_travail__services')
                field: id
      - name: value
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('thematiques_v1')
                field: value
