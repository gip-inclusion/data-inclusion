version: 2

sources:
  - name: data_inclusion
    schema: public
    tables:
      - name: annotation_dataset
      - name: annotation_datasetrow
      - name: annotation_annotation
      - name: external_insee_fichier_prenoms
      - name: sirene_etablissement_historique
      - name: sirene_etablissement_succession
      - name: extra__geocoded_results

  - name: insee
    schema: insee
    tables:
      - name: regions
      - name: departements
      - name: communes

  - name: dora
    schema: dora
    tables:
      - name: structures
      - name: services

  - name: finess
    schema: finess
    tables:
      - name: etablissements

  - name: siao
    schema: siao
    tables:
      - name: etablissements

  - name: un_jeune_une_solution
    schema: un_jeune_une_solution
    tables:
      - name: institutions
      - name: benefits

  - name: mes_aides
    schema: mes_aides
    tables:
      - name: garages
      - name: aides

  - name: annuaire_du_service_public
    schema: annuaire_du_service_public
    tables:
      - name: etablissements

  - name: cd35
    schema: cd35
    tables:
      - name: organisations

  - name: cd39
    schema: cd39
    tables:
      - name: structures_services


  - name: cd72
    schema: cd72
    tables:
      - name: rows

  - name: emplois_de_linclusion
    schema: emplois_de_linclusion
    tables:
      - name: siaes
      - name: organisations

  - name: mediation_numerique_angers
    schema: mediation_numerique_angers
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_assembleurs
    schema: mediation_numerique_assembleurs
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_cd17
    schema: mediation_numerique_cd17
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_cd23
    schema: mediation_numerique_cd23
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_cd28_appui_territorial
    schema: mediation_numerique_cd28_appui_territorial
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_cd33
    schema: mediation_numerique_cd33
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_cd40
    schema: mediation_numerique_cd40
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_cd44
    schema: mediation_numerique_cd44
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_cd49
    schema: mediation_numerique_cd49
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_cd87
    schema: mediation_numerique_cd87
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_conseiller_numerique
    schema: mediation_numerique_conseiller_numerique
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_conumm
    schema: mediation_numerique_conumm
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_cr93
    schema: mediation_numerique_cr93
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_etapes_numerique
    schema: mediation_numerique_etapes_numerique
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_fibre_64
    schema: mediation_numerique_fibre_64
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_france_services
    schema: mediation_numerique_france_services
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_france_tiers_lieux
    schema: mediation_numerique_france_tiers_lieux
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_francilin
    schema: mediation_numerique_francilin
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_hinaura
    schema: mediation_numerique_hinaura
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_hub_antilles
    schema: mediation_numerique_hub_antilles
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_hub_lo
    schema: mediation_numerique_hub_lo
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_mulhouse
    schema: mediation_numerique_mulhouse
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_numi
    schema: mediation_numerique_numi
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_res_in
    schema: mediation_numerique_res_in
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_rhinocc
    schema: mediation_numerique_rhinocc
    tables:
      - name: structures
      - name: services

  - name: mediation_numerique_ultra_numerique
    schema: mediation_numerique_ultra_numerique
    tables:
      - name: structures
      - name: services


  - name: odspep
    schema: odspep
    tables:
      - name: DD009_ACTIONs_DEMARCHES
      - name: DD009_ADRESSE
      - name: DD009_BASSIN_RESSOURCE
      - name: DD009_COMMUNE_RESSOURCE
      - name: DD009_CONTACT
      - name: DD009_CONTACT_PHYSIQUE
      - name: DD009_CONVENTION
      - name: DD009_CRITERE_PUBLIC
      - name: DD009_DEPARTEMENT_RESSOURCE
      - name: DD009_DIR_TERRITORIALE_OFII
      - name: DD009_HORAIRE
      - name: DD009_PARTENAIRE
      - name: DD009_PRESTATION_NAT
      - name: DD009_PRESTATION_REG
      - name: DD009_REGION_DEMARCHE_1
      - name: DD009_REGION_DEMARCHE_2
      - name: DD009_REGION_DEMARCHE_3
      - name: DD009_REGION_RESSOURCE_1
      - name: DD009_REGION_RESSOURCE_2
      - name: DD009_REGION_SUGGESTION
      - name: DD009_RES_PARTENARIALE

  - name: soliguide
    schema: soliguide
    tables:
      - name: lieux
        columns:
          - name: data
            tests:
              - expect_column_value_paths_to_exist:
                  config:
                    severity: error
                  path_list:
                    - '$.updatedAt'
                    - '$.lieu_id'
                    - '$.position.ville'
                    - '$.position.codePostal'
                    - '$.position.adresse'
                    - '$.position.location.coordinates[0]'
                    - '$.position.location.coordinates[1]'
                    - '$.seo_url'
                    - '$.name'
                    - '$.description'
                    - '$.entity.mail'
                    - '$.entity.website'
                    - '$.services_all'
                    - '$.services_all[*].serviceObjectId'
                    - '$.services_all[*].name'
                    - '$.services_all[*].categorie'
                    - '$.services_all[*].description'
              - expect_column_value_paths_to_exist:
                  config:
                    severity: warn
                  path_list:
                    - '$.position.complementAdresse' # used but sometime missing
                    - '$.position.region'
                    - '$.position.departement'
                    - '$.entity.facebook'
                    - '$.entity.instagram'
                    - '$.entity.phones'
                    - '$.entity.mail'
                    - '$.entity.fax'
                    - '$.modalities'
                    - '$._id'
                    - '$.tempInfos'
                    - '$.publics'
                    - '$.newhours'
                    - '$.close'
                    - '$.status'
                    - '$.visibility'
                    - '$.services_all[*].hours'
                    - '$.services_all[*].isOpenToday'
                    - '$.services_all[*].differentModalities'
                    - '$.services_all[*].publics'
                    - '$.services_all[*].saturated'
                    - '$.services_all[*].differentHours'
                    - '$.services_all[*].jobsList'
                    - '$.services_all[*].close'
                    - '$.services_all[*].createdAt'
                    - '$.services_all[*].updatedAt'
                    - '$.services_all[*].modalities'
                    - '$.services_all[*].differentModalities'

  - name: immersion_facilitee
    schema: immersion_facilitee
    description: >
      The team at Immersion Facilitee wants to use the siretisation UI.
      This source contains the data exported by IF for the purpose of siretisation.
    tables:
      - name: structures

  - name: monenfant
    schema: monenfant
    tables:
      - name: creches
        columns:
          - name: data
            tests:
              - expect_column_value_paths_to_exist:
                  config:
                    severity: error
                  path_list:
                    - '$.avip'
                    - '$.longitude'
                    - '$.latitude'
                    - '$.resultId'
                    - '$.ville'
                    - '$.telephone'
                    - '$.nom'
                    - '$.mail'
                    - '$.derniereModifDate'
                    - '$.adresse'
                    - '$.details.website'
                    - '$.details.infosPratiques.jourHoraire'
                    - '$.details.presentation.structureProjet'