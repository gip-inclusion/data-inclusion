{% macro card(result) -%}
    <li class="di-card">
        <div class="di-card-header">
            <h2>{{ result.service.structure.nom }}</h2>
            <h3>
                <a href="{{ result.service.lien_source|default('https://dora.inclusion.gouv.fr/services/di--' + result.service.id, True) }}"
                   target="_blank">{{ result.service.nom }}</a>
            </h3>
            <div class="di-card-location-row">
                {% if result.service.commune %}
                    {% if result.service.latitude and result.service.longitude %}
                    <a class="di-card-location" href="https://www.google.com/maps/place/{{ (result.service.adresse ~ ', ' ~ result.service.code_postal ~ ' ' ~ result.service.commune)|urlencode }}/@{{ result.service.latitude }},{{ result.service.longitude }},17z" target="_blank">
                        <img src="/widget/static/icons/map-pin-line.svg" alt="" class="di-icon" aria-hidden="true">
                        {{ result.service.commune }}
                    </a>
                    {% else %}
                    <span class="di-card-location">
                        <img src="/widget/static/icons/map-pin-line.svg" alt="" class="di-icon" aria-hidden="true">
                        {{ result.service.commune }}
                    </span>
                    {% endif %}
                    {% if result.distance is not none %}
                        <span class="di-card-spacer" aria-hidden="true"></span>
                        <span class="di-card-distance">
                            <img src="/widget/static/icons/route-line.svg" alt="" class="di-icon" aria-hidden="true">
                            {{ (result.distance) | round(0) | int }} km
                        </span>
                    {% endif %}
                {% else %}
                    <span class="di-card-location">
                        <img src="/widget/static/icons/global-line.svg" alt="" class="di-icon" aria-hidden="true">
                        Ã€ distance
                    </span>
                {% endif %}
            </div>
            {% if result.service.thematiques %}
                <div class="di-card-categories">
                    {% for item in result.service.thematiques | thematiques_filter(query_params_categories[0].value if query_params_categories else None) %}
                        <span class="di-badge{% if item.is_overflow %} di-badge-overflow{% endif %}">{{ item.label }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <p>
            {% if result.service.publics is not none %}
                {{ schema_publics | selectattr('value', 'in', result.service.publics) | map(attribute='label') | join(', ') }}
            {% else %}
                Tous les publics
            {% endif %}
        </p>
        <div class="di-card-footer">
            <span class="di-card-source">Source : {{ result.service.source }}</span>
        </div>
    </li>
{%- endmacro %}
