{% extends "base.html" %}
{% from "components/combobox.html" import combobox %}
{% from "components/select.html" import select %}
{% block content %}
    <main>
        {% if display_form %}
            <form aria-label="Rechercher des services"
                  hx-get="/widget/"
                  hx-target="#results"
                  hx-swap="outerHTML"
                  hx-trigger="change from:select, commune-selected"
                  hx-push-url="true">
                <input type="hidden" name="x" value="{{ query_params_x }}">
                <input type="hidden" name="y" value="{{ query_params_y }}">
                <input type="hidden"
                       name="score_qualite_minimum"
                       value="{{ query_params_score_qualite_minimum }}">
                <input type="hidden"
                       name="display_form"
                       value="{{ query_params_display_form|lower }}">
                <input type="hidden"
                       name="display_communes_filter"
                       value="{{ query_params_display_communes_filter|lower }}">
                <input type="hidden"
                       name="display_categories_filter"
                       value="{{ query_params_display_categories_filter|lower }}">
                <input type="hidden"
                       name="display_publics_filter"
                       value="{{ query_params_display_publics_filter|lower }}">
                <input type="hidden"
                       name="include_remote_services"
                       value="{{ query_params_include_remote_services|lower }}">
                {% if query_params_sources %}
                    {% for source in query_params_sources %}
                        <input type="hidden" name="sources" value="{{ source }}">
                    {% endfor %}
                {% endif %}
                {% if query_params_thematiques %}
                    {% for thematique in query_params_thematiques %}
                        <input type="hidden" name="thematiques" value="{{ thematique.value }}">
                    {% endfor %}
                {% elif not display_categories_filter and query_params_categories %}
                    {% for category in query_params_categories %}
                        <input type="hidden" name="categories" value="{{ category.value }}">
                    {% endfor %}
                {% endif %}
                {% if not display_publics_filter and query_params_publics %}
                    {% for public in query_params_publics %}
                        <input type="hidden" name="publics" value="{{ public.value }}">
                    {% endfor %}
                {% endif %}
                <input type="hidden" name="token" value="{{ token }}">
                <div class="di-filters-grid">
                    {% if display_communes_filter %}{{ combobox(query_params_commune_code, query_params_commune_label) }}{% endif %}
                    {% if display_categories_filter %}
                        {{ select("categories", "Thématiques", "Choisir une thématique", schema_categories, query_params_categories[0].value if query_params_categories else None, "Toutes thématiques") }}
                    {% endif %}
                    {% if display_publics_filter %}
                        {{ select("publics", "Publics", "Choisir un public", schema_publics, query_params_publics[0].value if query_params_publics else None) }}
                    {% endif %}
                </div>
            </form>
        {% endif %}
        {% include "fragments/results.html" %}
    </main>
{% endblock %}
